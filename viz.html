<!DOCTYPE html>
<meta charset="utf-8">
<head>
    
    <link rel="stylesheet" type="text/css" href="vizen.css" />

    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script  src="js/graph_viz.js"></script>
    <script  src="js/query_neo4j.js"></script>

    <script>
    var url = 'http://localhost:7474/db/data/cypher';
    
    function build_query(mode) {
        var query = 'START ';

        // define starting nodes
        if (mode == 'noun_state'){
            query += 'n=node:nouns(word="' + $('#noun1').val() +  '" ),m=node:stats(term="' + $('#statement1').val()  +'")\n';
        } else if (mode == 'noun_noun'){
            query += 'n=node:nouns(word="' + $('#noun1').val() +  '" ),m=node:nouns(word="' + $('#noun2').val() +'")\n';
        } else if (mode == 'state_state'){
            query += 'n=node:stats(term="'+ $('#statement1').val()  +'"),m=node:stats(term="'+ $('#statement2').val()  +'")\n';
        }
        // set algorithm and path length
        if ($('#allshorttest').is(':checked')){
            query += 'MATCH p=allShortestPaths((n)-[*..' + $('#max_length').val() +']->(m))\n';
        } else {
            query += 'MATCH p=shortestPath((n)-[*..' + $('#max_length').val() +']->(m))\n';
        }

        query += 'RETURN EXTRACT( n in FILTER( x IN nodes(p) WHERE HAS(x.word)) | [id(n),n.word] ) as nouns,\n';
        query += 'EXTRACT( s in FILTER( v IN nodes(p) WHERE HAS(v.term)) | [id(s),s.term] ) as stats,\n';
        query += 'EXTRACT( r IN relationships(p) |[id(r),type(r),r]) as rels, ';
        query += 'p LIMIT ' + $('#max_path').val() + ';'

        $('#query_input').val(query);
        return query;
        console.log(query); 
    } 
    </script>


</head>
<body>


<div id="control">
<h1>Weltvissualisation Demo</h1>
<div id="form_container">

    <form id="form_787881" class="appnitro"  method="post" action="">
                <div class="form_description">
    </div>                      
        <ul >
        
                <li id="li_1" >
    <label class="description" for="element_1">Nouns </label>
    <span>
        <input id="noun1" name= "noun1" class="element text" maxlength="255" size="20" value="house"/>
        <label class="sub_label">Noun1</label>
    </span>
    <span>
        <input id="noun2" name= "noun2" class="element text" maxlength="255" size="20" value="ball"/>
        <label class="sub_label">Noun2</label>
    </span>
    </li>       <li id="li_2" >
    <label class="description" for="element_2">Statements
</label>
    <span>
        <input id="statement1" name= "statement1" class="element text" maxlength="255" size="20" value="{dog} may bite {___}"/>
        <label class="sub_label">Statement1</label>
    </span>
    <span>
        <input id="statement2" name= "statement2" class="element text" maxlength="255" size="20" value="{ball} may hit {___}"/>
        <label class="sub_label">Statement2</label>
    </span> 
    </li>       <li id="li_7" >
    <label class="description" for="element_7">Algorithm</label>
    <span>
    <input id="shortest" name="element_7" class="element radio" type="radio" value="1" />
    <label class="choice" for="element_7_1">shortestPath</label>
    <input id="allshorttest" name="element_7" class="element radio" type="radio" value="2" checked="checked"/>
    <label class="choice" for="element_7_2">allShortestPath</label>

    </span> 
    </li>       <li id="li_5" >
    <label class="description" for="element_5">max path lenght </label>
    <div>
        <input id="max_length" name="element_5" class="element text small" type="text" maxlength="255" value="5"/> 
    </div> 
    </li>       <li id="li_6" >
    <label class="description" for="element_6">max path number returned </label>
    <div>
        <input id="max_path" name="element_6" class="element text small" type="text" maxlength="255" value="100"/> 
    </div> 
    </li>       <li id="li_3" >
    <label class="description" for="element_3">Neo4j Query </label>
    <div>
        <textarea id="query_input" name="query_input" class="element textarea medium">query</textarea> 
    </div> 
    </li>       <li id="li_4" >
    <label class="description" for="element_4">Results </label>
    <div>
        <textarea id="element_4" name="element_4" class="element textarea medium"></textarea> 
    </div> 

        </ul>
    </form>


<form action="textarea.htm">
<!--  <p>Enter Neo4j query<br>
    <textarea id="query_input" name="query_input" cols="80" rows="6">
START n=node:nouns(word="freedom"),m=node:stats(term="{ball} may hit {___}") Match p=allShortestPaths((n)-[*..4]->(m))
RETURN EXTRACT( n in FILTER( x IN nodes(p) WHERE HAS(x.word)) | [id(n),n.word] ) as nouns,
EXTRACT( s in FILTER( v IN nodes(p) WHERE HAS(v.term)) | [id(s),s.term] ) as stats,
EXTRACT( r IN relationships(p) |[id(r),type(r),r]) as rels,p LIMIT 10;
</textarea>-->
<input type="button" name="send_query" value="query noun1 state1"
  onclick="query_db(url,build_query('noun_state'));" />

<input type="button" name="send_noun" value="query noun1 noun2"
  onclick="query_db(url,build_query('noun_noun'));" />

<input type="button" name="send_stat" value="query state1 state2"
  onclick="query_db(url,build_query('state_state'));" />
</p>
</form>

</div>
</div>

<div id='draw_area'>
</div>

</body>
